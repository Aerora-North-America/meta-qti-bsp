#############################################################################
#@TYPE: Distribution
#@NAME: Micro MSM
#@DESCRIPTION: Micro Linux distribution for Qualcomm chipsets
#@MAINTAINER: Linux Build <linux.build@codeaurora.org>
#@COMMENT: This distribution configuration defines a truely tiny OE Linux
#@COMMENT: distribution. The matching buildable image target (micro-msm-image)
#@COMMENT: basically consists of: libc, busybox, udev, sysv init, and a few
#@COMMENT: init scripts for running up the system.
#############################################################################

#############################################################################
# DISTRO CONFIGURATION
#############################################################################
DISTRO_NAME = "micro-msm"
DISTRO_VERSION = "${SRCDATE}"

#############################################################################
# DISTRO FEATURE SELECTION
#############################################################################
# No features selected
DISTRO_FEATURES += "eabi"

#############################################################################
# LIBRARY NAMES
#############################################################################
# Use Debian naming scheme for library (.so) files
INHERIT += "debian"

#############################################################################
# PACKAGING & FEEDS
#############################################################################
# Select packaging system
PREFERRED_PKG_FORMAT = "ipk"
IPKG_VARIANT = "opkg"

require conf/distro/include/sane-feed.inc
require conf/distro/include/sane-feed-${PREFERRED_PKG_FORMAT}.inc

#############################################################################
# IMAGES
#############################################################################
# Name generated images
IMAGE_NAME = "${DISTRO_NAME}-${IMAGE_BASENAME}-${LIBC}-\
${PREFERRED_PKG_FORMAT}-${DISTRO_VERSION}-${MACHINE}"

CACHE ?= "${TMPDIR}/cache/${LIBC}/${MACHINE}"
DEPLOY_DIR ?= "${TMPDIR}/deploy/${LIBC}"
DEPLOY_DIR_IMAGE = "${DEPLOY_DIR}/images/${MACHINE}"
PACKAGE_EXTRA_ARCHS="armv7"

# Image output types
IMAGE_FSTYPES = "tar cpio.gz yaffs2"

# Extend the yaffs2 imaging command string to support setting the proper privs for the file.
IMAGE_CMD_yaffs2 += "; chmod 644 ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.yaffs2"

#############################################################################
# BOOTLOADER SELECTION
#############################################################################
PREFERRED_PROVIDERS += " virtual/bootloader:lk"

#############################################################################
# LINUX KERNEL SELECTION
#############################################################################
PREFERRED_PROVIDERS += "virtual/kernel:linux"
TARGET_OS = "linux-gnueabi"
KERNEL = "kernel26"
MACHINE_KERNEL_VERSION = "3.0.1"
KERNEL_IMAGETYPE = "Image"

# Kernel staging directories
STAGING_KERNEL_DIR = "${STAGING_DIR_HOST}/usr/src/linux"
STAGING_KERNEL_HEADERS = "${STAGING_KERNEL_DIR}/usr/include"
STAGING_KERNEL_MODULES = "${STAGING_DIR_HOST}/lib/modules"

#############################################################################
# TOOLCHAIN
#############################################################################
LIBC ?= "eglibc"
PREFERRED_VERSION_glibc             ?= "2.10.1"
PREFERRED_VERSION_glibc-initial     ?= "2.10.1"
PREFERRED_ARM_INSTRUCTION_SET ?= "thumb"
require conf/distro/include/sane-toolchain.inc
require conf/distro/include/arm-thumb.inc

#############################################################################
# Ensure MACHINE_CLASS is in OVERRIDES
#############################################################################
MACHINE_CLASS ?= ""
MACHINE_OVERRIDES += "${MACHINE_CLASS}"

#############################################################################
# NLS
#############################################################################
USE_NLS = "no"
USE_NLS_glib-2.0 = "yes"
USE_NLS_glib-2.0-native = "yes"
USE_NLS_gcc-cross = "no"

#############################################################################
# Development Tools
#############################################################################
INHERIT += "devshell"

# Disable binary locale generation
ENABLE_BINARY_LOCALE_GENERATION = "0"

# Don't install useless symlinks to libraries
PACKAGE_SNAP_LIB_SYMLINKS = "1"

# Collapse /usr into /
prefix = ""
exec_prefix = ""
prefix_native = ""

# Don't install ldconfig and associated gubbins
USE_LDCONFIG = "0"

# Disable online package management
ONLINE_PACKAGE_MANAGEMENT = "none"

DISTRO_BLUETOOTH_MANAGER = "bluez4"
