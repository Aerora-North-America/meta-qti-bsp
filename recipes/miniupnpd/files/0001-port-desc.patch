From 59cf646f624f677aac9ff94733d87965763ad82a Mon Sep 17 00:00:00 2001
From: Tyler Wear <twear@codeaurora.org>
Date: Thu, 31 Jul 2014 11:12:43 -0700
Subject: [PATCH 1/1] port-desc

---
 commonrdr.h         | 14 ++++++++++----
 netfilter/iptcrdr.c |  6 +++++-
 2 files changed, 15 insertions(+), 5 deletions(-)
 mode change 100644 => 100755 commonrdr.h
 mode change 100644 => 100755 netfilter/iptcrdr.c

diff --git a/commonrdr.h b/commonrdr.h
old mode 100644
new mode 100755
index 7c0bd7c..96b2833
--- a/commonrdr.h
+++ b/commonrdr.h
@@ -30,8 +30,11 @@ get_redirect_rule(const char * ifname, unsigned short eport, int proto,
                   char * iaddr, int iaddrlen, unsigned short * iport,
                   char * desc, int desclen,
                   char * rhost, int rhostlen,
-                  unsigned int * timestamp,
-                  u_int64_t * packets, u_int64_t * bytes);
+                  unsigned int * timestamp
+#ifndef QCMAP
+                  ,u_int64_t * packets, u_int64_t * bytes
+#endif
+                  );
 
 /* get_redirect_rule_by_index()
  * return values :
@@ -43,8 +46,11 @@ get_redirect_rule_by_index(int index,
                            char * iaddr, int iaddrlen, unsigned short * iport,
                            int * proto, char * desc, int desclen,
                            char * rhost, int rhostlen,
-                           unsigned int * timestamp,
-                           u_int64_t * packets, u_int64_t * bytes);
+                           unsigned int * timestamp
+#ifndef QCMAP
+                  ,u_int64_t * packets, u_int64_t * bytes
+#endif
+                  );
 
 /* return an (malloc'ed) array of "external" port for which there is
  * a port mapping. number is the size of the array */
diff --git a/netfilter/iptcrdr.c b/netfilter/iptcrdr.c
old mode 100644
new mode 100755
index a93c1cf..cfa24e5
--- a/netfilter/iptcrdr.c
+++ b/netfilter/iptcrdr.c
@@ -4,7 +4,9 @@
  * (c) 2006-2011 Thomas Bernard
  * This software is subject to the conditions detailed
  * in the LICENCE file provided within the distribution */
+#include "../config.h"
 #include <stdio.h>
+#ifndef QCMAP
 #include <stdlib.h>
 #include <string.h>
 #include <syslog.h>
@@ -101,7 +103,7 @@ static int snprintip(char * dst, size_t size, uint32_t ip)
 	       "%u.%u.%u.%u", ip >> 24, (ip >> 16) & 0xff,
 	       (ip >> 8) & 0xff, ip & 0xff);
 }
-
+#endif
 /* netfilter cannot store redirection descriptions, so we use our
  * own structure to store them */
 struct rdr_desc {
@@ -211,6 +213,7 @@ get_redirect_desc_by_index(int index, unsigned short * eport, int * proto,
 }
 #endif
 
+#ifndef QCMAP
 /* add_redirect_rule2() */
 int
 add_redirect_rule2(const char * ifname,
@@ -1544,3 +1547,4 @@ list_redirect_rule(const char * ifname)
 	return 0;
 }
 #endif
+#endif
-- 
1.8.2.1

